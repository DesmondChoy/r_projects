---
title: Scoring Visualization Goals with PCA and FIFA 20
author: Desmond Choy
date: '2020-06-18'
slug: scoring-visualization-goals-with-pca-and-fifa-20.en-us
summary: The FIFA20 player dataset is visualized using ridgeline plots and network graphs. Unsupervised machine learning (Principal Components Analysis) is also used to generate a new set of statistically independent features.
readingtime: '16'
tags:
  - r
  - EDA
  - machine learning
  - visualization
coverImage: https://images.unsplash.com/photo-1544698310-74ea9d1c8258?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1490&q=80
thumbnailImage: https://images.unsplash.com/photo-1543351611-58f69d7c1781?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=500&q=60
thumbnailImagePosition: left
coverCaption: Voting By Donnycocacola
---



<p>I came across this interesting <a href="https://www.kaggle.com/stefanoleone992/fifa-20-complete-player-dataset">dataset</a> on Kaggle related to the football simulation video game <strong>FIFA 20</strong>, with a very detailed breakdown of attributes of over 18,000 football players. It’s been a while since I’ve played a FIFA game, and an even longer time since I last worn my soccer boots, but this seemed like an excellent data set for some Exploratory Data Analysis. I also showcase ridgeline plots and network graphs with wrangled data, and take a stab at implementing and interpreting unsupervised machine learning in the form of Principal Components Analysis on our wide data set.</p>
<div id="libraries" class="section level1">
<h1>Libraries</h1>
<pre class="r"><code>library(tidyverse) #data wrangling
library(fishualize) #visualization

theme_set(theme_minimal())</code></pre>
</div>
<div id="loading-the-data" class="section level1">
<h1>Loading The Data</h1>
<pre class="r"><code>data &lt;- read_csv(&quot;https://raw.githubusercontent.com/DesmondChoy/glaciers/master/content/post/players_20.csv&quot;)
glimpse(data)</code></pre>
<pre><code>## Rows: 18,278
## Columns: 104
## $ sofifa_id                  &lt;dbl&gt; 158023, 20801, 190871, 200389, 183277, 1...
## $ player_url                 &lt;chr&gt; &quot;https://sofifa.com/player/158023/lionel...
## $ short_name                 &lt;chr&gt; &quot;L. Messi&quot;, &quot;Cristiano Ronaldo&quot;, &quot;Neymar...
## $ long_name                  &lt;chr&gt; &quot;Lionel Andrés Messi Cuccittini&quot;, &quot;Crist...
## $ age                        &lt;dbl&gt; 32, 34, 27, 26, 28, 28, 27, 27, 33, 27, ...
## $ dob                        &lt;date&gt; 1987-06-24, 1985-02-05, 1992-02-05, 199...
## $ height_cm                  &lt;dbl&gt; 170, 187, 175, 188, 175, 181, 187, 193, ...
## $ weight_kg                  &lt;dbl&gt; 72, 83, 68, 87, 74, 70, 85, 92, 66, 71, ...
## $ nationality                &lt;chr&gt; &quot;Argentina&quot;, &quot;Portugal&quot;, &quot;Brazil&quot;, &quot;Slov...
## $ club                       &lt;chr&gt; &quot;FC Barcelona&quot;, &quot;Juventus&quot;, &quot;Paris Saint...
## $ overall                    &lt;dbl&gt; 94, 93, 92, 91, 91, 91, 90, 90, 90, 90, ...
## $ potential                  &lt;dbl&gt; 94, 93, 92, 93, 91, 91, 93, 91, 90, 90, ...
## $ value_eur                  &lt;dbl&gt; 95500000, 58500000, 105500000, 77500000,...
## $ wage_eur                   &lt;dbl&gt; 565000, 405000, 290000, 125000, 470000, ...
## $ player_positions           &lt;chr&gt; &quot;RW, CF, ST&quot;, &quot;ST, LW&quot;, &quot;LW, CAM&quot;, &quot;GK&quot;,...
## $ preferred_foot             &lt;chr&gt; &quot;Left&quot;, &quot;Right&quot;, &quot;Right&quot;, &quot;Right&quot;, &quot;Righ...
## $ international_reputation   &lt;dbl&gt; 5, 5, 5, 3, 4, 4, 3, 3, 4, 3, 3, 3, 3, 3...
## $ weak_foot                  &lt;dbl&gt; 4, 4, 5, 3, 4, 5, 4, 3, 4, 3, 4, 3, 4, 3...
## $ skill_moves                &lt;dbl&gt; 4, 5, 5, 1, 4, 4, 1, 2, 4, 4, 5, 2, 3, 1...
## $ work_rate                  &lt;chr&gt; &quot;Medium/Low&quot;, &quot;High/Low&quot;, &quot;High/Medium&quot;,...
## $ body_type                  &lt;chr&gt; &quot;Messi&quot;, &quot;C. Ronaldo&quot;, &quot;Neymar&quot;, &quot;Normal...
## $ real_face                  &lt;chr&gt; &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Yes&quot;...
## $ release_clause_eur         &lt;dbl&gt; 195800000, 96500000, 195200000, 16470000...
## $ player_tags                &lt;chr&gt; &quot;#Dribbler, #Distance Shooter, #Crosser,...
## $ team_position              &lt;chr&gt; &quot;RW&quot;, &quot;LW&quot;, &quot;CAM&quot;, &quot;GK&quot;, &quot;LW&quot;, &quot;RCM&quot;, &quot;G...
## $ team_jersey_number         &lt;dbl&gt; 10, 7, 10, 13, 7, 17, 1, 4, 10, 11, 7, 2...
## $ loaned_from                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, ...
## $ joined                     &lt;date&gt; 2004-07-01, 2018-07-10, 2017-08-03, 201...
## $ contract_valid_until       &lt;dbl&gt; 2021, 2022, 2022, 2023, 2024, 2023, 2022...
## $ nation_position            &lt;chr&gt; NA, &quot;LS&quot;, &quot;LW&quot;, &quot;GK&quot;, &quot;LF&quot;, &quot;RCM&quot;, &quot;SUB&quot;...
## $ nation_jersey_number       &lt;dbl&gt; NA, 7, 10, 1, 10, 7, 22, 4, NA, 10, 10, ...
## $ pace                       &lt;dbl&gt; 87, 90, 91, NA, 91, 76, NA, 77, 74, 93, ...
## $ shooting                   &lt;dbl&gt; 92, 93, 85, NA, 83, 86, NA, 60, 76, 86, ...
## $ passing                    &lt;dbl&gt; 92, 82, 87, NA, 86, 92, NA, 70, 89, 81, ...
## $ dribbling                  &lt;dbl&gt; 96, 89, 95, NA, 94, 86, NA, 71, 89, 89, ...
## $ defending                  &lt;dbl&gt; 39, 35, 32, NA, 35, 61, NA, 90, 72, 45, ...
## $ physic                     &lt;dbl&gt; 66, 78, 58, NA, 66, 78, NA, 86, 66, 74, ...
## $ gk_diving                  &lt;dbl&gt; NA, NA, NA, 87, NA, NA, 88, NA, NA, NA, ...
## $ gk_handling                &lt;dbl&gt; NA, NA, NA, 92, NA, NA, 85, NA, NA, NA, ...
## $ gk_kicking                 &lt;dbl&gt; NA, NA, NA, 78, NA, NA, 88, NA, NA, NA, ...
## $ gk_reflexes                &lt;dbl&gt; NA, NA, NA, 89, NA, NA, 90, NA, NA, NA, ...
## $ gk_speed                   &lt;dbl&gt; NA, NA, NA, 52, NA, NA, 45, NA, NA, NA, ...
## $ gk_positioning             &lt;dbl&gt; NA, NA, NA, 90, NA, NA, 88, NA, NA, NA, ...
## $ player_traits              &lt;chr&gt; &quot;Beat Offside Trap, Argues with Official...
## $ attacking_crossing         &lt;dbl&gt; 88, 84, 87, 13, 81, 93, 18, 53, 86, 79, ...
## $ attacking_finishing        &lt;dbl&gt; 95, 94, 87, 11, 84, 82, 14, 52, 72, 90, ...
## $ attacking_heading_accuracy &lt;dbl&gt; 70, 89, 62, 15, 61, 55, 11, 86, 55, 59, ...
## $ attacking_short_passing    &lt;dbl&gt; 92, 83, 87, 43, 89, 92, 61, 78, 92, 84, ...
## $ attacking_volleys          &lt;dbl&gt; 88, 87, 87, 13, 83, 82, 14, 45, 76, 79, ...
## $ skill_dribbling            &lt;dbl&gt; 97, 89, 96, 12, 95, 86, 21, 70, 87, 89, ...
## $ skill_curve                &lt;dbl&gt; 93, 81, 88, 13, 83, 85, 18, 60, 85, 83, ...
## $ skill_fk_accuracy          &lt;dbl&gt; 94, 76, 87, 14, 79, 83, 12, 70, 78, 69, ...
## $ skill_long_passing         &lt;dbl&gt; 92, 77, 81, 40, 83, 91, 63, 81, 88, 75, ...
## $ skill_ball_control         &lt;dbl&gt; 96, 92, 95, 30, 94, 91, 30, 76, 92, 89, ...
## $ movement_acceleration      &lt;dbl&gt; 91, 89, 94, 43, 94, 77, 38, 74, 77, 94, ...
## $ movement_sprint_speed      &lt;dbl&gt; 84, 91, 89, 60, 88, 76, 50, 79, 71, 92, ...
## $ movement_agility           &lt;dbl&gt; 93, 87, 96, 67, 95, 78, 37, 61, 92, 91, ...
## $ movement_reactions         &lt;dbl&gt; 95, 96, 92, 88, 90, 91, 86, 88, 89, 92, ...
## $ movement_balance           &lt;dbl&gt; 95, 71, 84, 49, 94, 76, 43, 53, 93, 88, ...
## $ power_shot_power           &lt;dbl&gt; 86, 95, 80, 59, 82, 91, 66, 81, 79, 80, ...
## $ power_jumping              &lt;dbl&gt; 68, 95, 61, 78, 56, 63, 79, 90, 68, 69, ...
## $ power_stamina              &lt;dbl&gt; 75, 85, 81, 41, 84, 89, 35, 75, 85, 85, ...
## $ power_strength             &lt;dbl&gt; 68, 78, 49, 78, 63, 74, 78, 92, 58, 73, ...
## $ power_long_shots           &lt;dbl&gt; 94, 93, 84, 12, 80, 90, 10, 64, 82, 84, ...
## $ mentality_aggression       &lt;dbl&gt; 48, 63, 51, 34, 54, 76, 43, 82, 62, 63, ...
## $ mentality_interceptions    &lt;dbl&gt; 40, 29, 36, 19, 41, 61, 22, 89, 82, 55, ...
## $ mentality_positioning      &lt;dbl&gt; 94, 95, 87, 11, 87, 88, 11, 47, 79, 92, ...
## $ mentality_vision           &lt;dbl&gt; 94, 82, 90, 65, 89, 94, 70, 65, 91, 84, ...
## $ mentality_penalties        &lt;dbl&gt; 75, 85, 90, 11, 88, 79, 25, 62, 82, 77, ...
## $ mentality_composure        &lt;dbl&gt; 96, 95, 94, 68, 91, 91, 70, 89, 92, 91, ...
## $ defending_marking          &lt;dbl&gt; 33, 28, 27, 27, 34, 68, 25, 91, 68, 38, ...
## $ defending_standing_tackle  &lt;dbl&gt; 37, 32, 26, 12, 27, 58, 13, 92, 76, 43, ...
## $ defending_sliding_tackle   &lt;dbl&gt; 26, 24, 29, 18, 22, 51, 10, 85, 71, 41, ...
## $ goalkeeping_diving         &lt;dbl&gt; 6, 7, 9, 87, 11, 15, 88, 13, 13, 14, 13,...
## $ goalkeeping_handling       &lt;dbl&gt; 11, 11, 9, 92, 12, 13, 85, 10, 9, 14, 5,...
## $ goalkeeping_kicking        &lt;dbl&gt; 15, 15, 15, 78, 6, 5, 88, 13, 7, 9, 7, 7...
## $ goalkeeping_positioning    &lt;dbl&gt; 14, 14, 15, 90, 8, 10, 88, 11, 14, 11, 1...
## $ goalkeeping_reflexes       &lt;dbl&gt; 8, 11, 11, 89, 8, 13, 90, 11, 9, 14, 6, ...
## $ ls                         &lt;chr&gt; &quot;89+2&quot;, &quot;91+3&quot;, &quot;84+3&quot;, NA, &quot;83+3&quot;, &quot;82+...
## $ st                         &lt;chr&gt; &quot;89+2&quot;, &quot;91+3&quot;, &quot;84+3&quot;, NA, &quot;83+3&quot;, &quot;82+...
## $ rs                         &lt;chr&gt; &quot;89+2&quot;, &quot;91+3&quot;, &quot;84+3&quot;, NA, &quot;83+3&quot;, &quot;82+...
## $ lw                         &lt;chr&gt; &quot;93+2&quot;, &quot;89+3&quot;, &quot;90+3&quot;, NA, &quot;89+3&quot;, &quot;87+...
## $ lf                         &lt;chr&gt; &quot;93+2&quot;, &quot;90+3&quot;, &quot;89+3&quot;, NA, &quot;88+3&quot;, &quot;87+...
## $ cf                         &lt;chr&gt; &quot;93+2&quot;, &quot;90+3&quot;, &quot;89+3&quot;, NA, &quot;88+3&quot;, &quot;87+...
## $ rf                         &lt;chr&gt; &quot;93+2&quot;, &quot;90+3&quot;, &quot;89+3&quot;, NA, &quot;88+3&quot;, &quot;87+...
## $ rw                         &lt;chr&gt; &quot;93+2&quot;, &quot;89+3&quot;, &quot;90+3&quot;, NA, &quot;89+3&quot;, &quot;87+...
## $ lam                        &lt;chr&gt; &quot;93+2&quot;, &quot;88+3&quot;, &quot;90+3&quot;, NA, &quot;89+3&quot;, &quot;88+...
## $ cam                        &lt;chr&gt; &quot;93+2&quot;, &quot;88+3&quot;, &quot;90+3&quot;, NA, &quot;89+3&quot;, &quot;88+...
## $ ram                        &lt;chr&gt; &quot;93+2&quot;, &quot;88+3&quot;, &quot;90+3&quot;, NA, &quot;89+3&quot;, &quot;88+...
## $ lm                         &lt;chr&gt; &quot;92+2&quot;, &quot;88+3&quot;, &quot;89+3&quot;, NA, &quot;89+3&quot;, &quot;88+...
## $ lcm                        &lt;chr&gt; &quot;87+2&quot;, &quot;81+3&quot;, &quot;82+3&quot;, NA, &quot;83+3&quot;, &quot;87+...
## $ cm                         &lt;chr&gt; &quot;87+2&quot;, &quot;81+3&quot;, &quot;82+3&quot;, NA, &quot;83+3&quot;, &quot;87+...
## $ rcm                        &lt;chr&gt; &quot;87+2&quot;, &quot;81+3&quot;, &quot;82+3&quot;, NA, &quot;83+3&quot;, &quot;87+...
## $ rm                         &lt;chr&gt; &quot;92+2&quot;, &quot;88+3&quot;, &quot;89+3&quot;, NA, &quot;89+3&quot;, &quot;88+...
## $ lwb                        &lt;chr&gt; &quot;68+2&quot;, &quot;65+3&quot;, &quot;66+3&quot;, NA, &quot;66+3&quot;, &quot;77+...
## $ ldm                        &lt;chr&gt; &quot;66+2&quot;, &quot;61+3&quot;, &quot;61+3&quot;, NA, &quot;63+3&quot;, &quot;77+...
## $ cdm                        &lt;chr&gt; &quot;66+2&quot;, &quot;61+3&quot;, &quot;61+3&quot;, NA, &quot;63+3&quot;, &quot;77+...
## $ rdm                        &lt;chr&gt; &quot;66+2&quot;, &quot;61+3&quot;, &quot;61+3&quot;, NA, &quot;63+3&quot;, &quot;77+...
## $ rwb                        &lt;chr&gt; &quot;68+2&quot;, &quot;65+3&quot;, &quot;66+3&quot;, NA, &quot;66+3&quot;, &quot;77+...
## $ lb                         &lt;chr&gt; &quot;63+2&quot;, &quot;61+3&quot;, &quot;61+3&quot;, NA, &quot;61+3&quot;, &quot;73+...
## $ lcb                        &lt;chr&gt; &quot;52+2&quot;, &quot;53+3&quot;, &quot;46+3&quot;, NA, &quot;49+3&quot;, &quot;66+...
## $ cb                         &lt;chr&gt; &quot;52+2&quot;, &quot;53+3&quot;, &quot;46+3&quot;, NA, &quot;49+3&quot;, &quot;66+...
## $ rcb                        &lt;chr&gt; &quot;52+2&quot;, &quot;53+3&quot;, &quot;46+3&quot;, NA, &quot;49+3&quot;, &quot;66+...
## $ rb                         &lt;chr&gt; &quot;63+2&quot;, &quot;61+3&quot;, &quot;61+3&quot;, NA, &quot;61+3&quot;, &quot;73+...</code></pre>
<p>Without a data dictionary, I went to the website where the data was scrapped from and looked into a <a href="https://sofifa.com/player/205632/lucas-ocampos/200046/">player’s profile</a> to make sense of the columns. Removing some columns that we won’t be using, we’re left with 76 columns and over 18,000 rows of data.</p>
<pre class="r"><code>data &lt;- data %&gt;% 
  select(-c(player_url, real_face, ls:rb))

dim(data)</code></pre>
<pre><code>## [1] 18278    76</code></pre>
</div>
<div id="data-discrepancies" class="section level1">
<h1>Data Discrepancies</h1>
<p>I note the <a href="https://sofifa.com/">website</a> where the data was scrapped from has its data updated once every few days. So there might be discrepancies if you’re comparing the numbers in this data set to the latest ones featured on the website.</p>
<p>Additionally, I was doing a little fact-checking online and some columns don’t tally to real-life figures (understandably, FIFA 20 is a video game). For instance, the player with the highest release clause in real life is <a href="https://www.sportbible.com/football/news-the-top-10-highest-release-clauses-in-world-football-today-20200211">Karim Benzema at GBP846m</a>. In this data set however, even after accounting for currency translations, Benzema does not even appear in the top 10 list for release clauses.</p>
<pre class="r"><code>data %&gt;%
  select(short_name, club, release_clause_eur, wage_eur) %&gt;% 
  arrange(desc(release_clause_eur))</code></pre>
<pre><code>## # A tibble: 18,278 x 4
##    short_name    club                release_clause_eur wage_eur
##    &lt;chr&gt;         &lt;chr&gt;                            &lt;dbl&gt;    &lt;dbl&gt;
##  1 L. Messi      FC Barcelona                 195800000   565000
##  2 Neymar Jr     Paris Saint-Germain          195200000   290000
##  3 K. Mbappé     Paris Saint-Germain          191700000   155000
##  4 E. Hazard     Real Madrid                  184500000   470000
##  5 K. De Bruyne  Manchester City              166500000   370000
##  6 J. Oblak      Atlético Madrid              164700000   125000
##  7 H. Kane       Tottenham Hotspur            159800000   220000
##  8 V. van Dijk   Liverpool                    150200000   200000
##  9 M. Salah      Liverpool                    148900000   240000
## 10 M. ter Stegen FC Barcelona                 143400000   250000
## # ... with 18,268 more rows</code></pre>
<pre class="r"><code>data %&gt;%
  select(short_name, club, release_clause_eur, wage_eur) %&gt;% 
  filter(str_detect(short_name, &quot;Benzema&quot;))</code></pre>
<pre><code>## # A tibble: 1 x 4
##   short_name club        release_clause_eur wage_eur
##   &lt;chr&gt;      &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;
## 1 K. Benzema Real Madrid           92300000   285000</code></pre>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1>Exploratory Data Analysis</h1>
<p>Going through the data, it looks largely sanitized. One issue I noted is that a player can be assigned to many different <code>player_positions</code>.</p>
<pre class="r"><code>data %&gt;% 
  select(short_name, team_position, player_positions) %&gt;% 
  sample_n(10)</code></pre>
<pre><code>## # A tibble: 10 x 3
##    short_name     team_position player_positions
##    &lt;chr&gt;          &lt;chr&gt;         &lt;chr&gt;           
##  1 M. Vihmann     LCB           CB              
##  2 N. Al Ghamdi   RES           GK              
##  3 J. Mendes      SUB           ST, RM          
##  4 C. Gasper      LB            LB, CB          
##  5 G. Ortíz       SUB           CB              
##  6 D. Russo       SUB           GK              
##  7 P. Vaquizo     &lt;NA&gt;          RW, RM          
##  8 I. Opara       RCB           CB              
##  9 A. Al Owayshir SUB           GK              
## 10 J. Bumbu       RES           CM, CDM</code></pre>
<p>Let’s clean the data further by lumping the player’s position into broader categories - Goalkeeper (G), Defender (D), Defensive Midfielder (DM), Midfielder (M), Attacking Midfielder (AM), Forward (F) and Striker (ST). I’ll do this by inferring from the player’s <code>player_positions</code>. Fewer categories will benefit data visualization.</p>
<pre class="r"><code>data &lt;- data %&gt;%
  mutate(
    position = case_when(
      str_detect(player_positions, &quot;GK&quot;) ~ &quot;GK&quot;,
      str_detect(player_positions, &quot;LCB|CB|RCB|LB|RB&quot;) ~ &quot;D&quot;,
      str_detect(player_positions, &quot;LWB|LDM|CDM|RDM|RWB&quot;) ~ &quot;DM&quot;,
      str_detect(player_positions, &quot;LM|LCM|CM|RCM|RM&quot;) ~ &quot;M&quot;,
      str_detect(player_positions, &quot;LAM|CAM|RAM&quot;) ~ &quot;AM&quot;,
      str_detect(player_positions, &quot;LW|LF|CF|RF|RW&quot;) ~ &quot;F&quot;,
      str_detect(player_positions, &quot;LS|ST|RS&quot;) ~ &quot;ST&quot;
    )) %&gt;% 
  mutate(position = fct_relevel(position, &quot;GK&quot;, &quot;D&quot;, &quot;DM&quot;, &quot;M&quot;, &quot;AM&quot;, &quot;F&quot;, &quot;ST&quot;))</code></pre>
<p>Let’s check if <code>position</code> is mapped correctly. Cross referencing selected columns and using personal albeit rusty domain knowledge, it looks correct - Goalkeepers only have <code>gk_diving</code> points, Defenders have higher <code>defending</code> points relative to <code>shooting</code> and <code>dribbling</code>, and the more offensive positions like Forwards and Strikers score higher in the <code>shooting</code> category.</p>
<pre class="r"><code>set.seed(2020)
#Checking if position is extracted correctly
data %&gt;%
  select(short_name,
         position,
         player_positions,
         shooting:dribbling,
         gk_diving) %&gt;%
  sample_n(10) %&gt;%
  arrange(position)</code></pre>
<pre><code>## # A tibble: 10 x 7
##    short_name     position player_positions shooting passing dribbling gk_diving
##    &lt;chr&gt;          &lt;fct&gt;    &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 R. Ruiter      GK       GK                     NA      NA        NA        66
##  2 F. Woodman     GK       GK                     NA      NA        NA        66
##  3 F. Dimarco     D        LB, LM                 33      66        61        NA
##  4 A. Espino      D        LB                     59      62        64        NA
##  5 M. Pietrowski  D        RB                     55      63        64        NA
##  6 P. Martinez    D        CB                     45      63        69        NA
##  7 N. Pépé        M        RM, RW, ST             81      75        85        NA
##  8 Bruno Costa    M        CM                     63      68        72        NA
##  9 D. Butterworth F        ST, CF                 56      45        54        NA
## 10 Li Haowen      ST       ST                     56      39        51        NA</code></pre>
<p>What is the <code>overall</code> score distributed across all players?</p>
<pre class="r"><code>data %&gt;% 
  ggplot(aes(overall)) +
  geom_histogram(binwidth = 2, fill = &quot;#00AFBB&quot;, color=&quot;#e9ecef&quot;, alpha=0.6) +
  labs(
    x = &quot;Overall Score&quot;,
    y = &quot;Count&quot;,
    title = &quot;Using A Histogram to Analyze Distribution of Overall Scores&quot;,
    subtitle = &quot;The Overall scores variable has a normal bell-shaped distribution, implying the players are graded on a curve&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/overall%20histogram-1.png" width="1152" /></p>
<div id="players-without-club-contracts" class="section level2">
<h2>Players Without Club Contracts</h2>
<p>I noticed the variables <code>team_position</code> and <code>team_jersey_number</code> have missing values. We can ascertain the relationship between both columns by counting the NAs and checking if they’re equal.</p>
<pre class="r"><code>data %&gt;% 
  select(contains(&quot;team&quot;)) %&gt;% 
  map_df(~sum(is.na(.)))</code></pre>
<pre><code>## # A tibble: 1 x 2
##   team_position team_jersey_number
##           &lt;int&gt;              &lt;int&gt;
## 1           240                240</code></pre>
<p>Why do certain players have no <code>team_position</code> ?</p>
<pre class="r"><code>data %&gt;%
  filter(is.na(team_position)) %&gt;%
  select(
    short_name,
    club,
    nation_position,
    player_positions,
    team_position,
    team_jersey_number,
    value_eur
  ) %&gt;%
  head(10)</code></pre>
<pre><code>## # A tibble: 10 x 7
##    short_name club  nation_position player_positions team_position
##    &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;        
##  1 E. Scheti~ Urug~ RCB             CB               &lt;NA&gt;         
##  2 J. Sildero Urug~ RM              CAM, RM          &lt;NA&gt;         
##  3 J. Frenda~ Urug~ LCB             CB, CDM          &lt;NA&gt;         
##  4 S. Ardero  Urug~ LM              CAM, LM, LW      &lt;NA&gt;         
##  5 L. Dálves  Urug~ ST              ST, CF           &lt;NA&gt;         
##  6 S. Mandíq~ Ecua~ RS              ST               &lt;NA&gt;         
##  7 J. Serend~ Urug~ GK              GK               &lt;NA&gt;         
##  8 M. Baldona Urug~ RDM             CDM, CM          &lt;NA&gt;         
##  9 M. Nérez   Urug~ LB              LB, LM           &lt;NA&gt;         
## 10 A. Lunev   Russ~ SUB             GK               &lt;NA&gt;         
## # ... with 2 more variables: team_jersey_number &lt;dbl&gt;, value_eur &lt;dbl&gt;</code></pre>
<p>It seems these players entered the database because they represented their country but aren’t contracted with any clubs. If they are good enough to represent their country, shouldn’t they at least be good enough for some entry-level clubs? <strong>As a player-manager in FIFA 20, is this an untapped pool of talent waiting to be exploited?</strong></p>
<p>Let’s explore if this phenomenon is restricted to only certain geographical areas.</p>
<pre class="r"><code>library(countrycode)
library(tidytext)

data %&gt;%
  filter(is.na(team_position)) %&gt;%
  mutate(continent = countrycode(club,
                                 origin = &quot;country.name&quot;,
                                 destination = &quot;continent&quot;)) %&gt;%
  mutate(continent = replace_na(continent, &quot;Europe&quot;)) %&gt;%
  add_count(club) %&gt;%
  mutate(club = reorder_within(club, n, continent)) %&gt;%
  ggplot(aes(club, n / n, fill = continent)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  facet_wrap( ~ continent, scales = &quot;free_y&quot;) +
  scale_x_reordered() +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(
    x = &quot;&quot;,
    y = &quot;&quot;,
    title = &quot;Continents With Highest # Of International Players With No Clubs/Contracts&quot;,
    subtitle = &quot;A higher percentage of players come from Africa, Americas and Europe.\nPerhaps these are countries with no well-established soccer leagues?&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/ggplot%20continents-1.png" width="1152" /></p>
<p>Are these players without contracts because overall performance is trailing far behind potential? Let’s analyze it further across <code>position</code>.</p>
<pre class="r"><code>library(ggridges)

data %&gt;%
  filter(is.na(team_position)) %&gt;%
  pivot_longer(overall:potential, names_to = &quot;rating&quot;, values_to = &quot;values&quot;) %&gt;%
  mutate(rating = as_factor(rating)) %&gt;%
  ggplot(aes(values, position, fill = rating)) +
  geom_density_ridges(scale = 1, alpha = 0.5) +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  theme_ridges(center_axis_labels = TRUE) +
  labs(
    x = NULL,
    y = NULL,
    fill = &quot;Score&quot;,
    title = &quot;Players Without Contracts: Comparing Overall vs Potential Score Across Positions&quot;,
    subtitle = &quot;Not playing up to one&#39;s potential seems to be pervasive across all field positions&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
    legend.title = element_text(face = &quot;bold&quot;, size = 15)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/geom%20ridge1-1.png" width="1152" /></p>
<p>Testing our hypothesis if it is indeed a performance gap that is resulting in these players to be contract-less, can we then expect players with contracts to be playing much closer to their potential?</p>
<pre class="r"><code>data %&gt;%
  filter(!is.na(team_position)) %&gt;%
  pivot_longer(overall:potential, names_to = &quot;rating&quot;, values_to = &quot;values&quot;) %&gt;%
  mutate(rating = as_factor(rating)) %&gt;%
  ggplot(aes(values, position, fill = rating)) +
  geom_density_ridges(scale = 1, alpha = 0.5) +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  theme_ridges(center_axis_labels = TRUE) +
  labs(
    x = NULL,
    y = NULL,
    fill = &quot;Score&quot;,
    title = &quot;Players With Contracts: Comparing Overall vs Potential Score Across Positions&quot;,
    subtitle = &quot;Ironically, the gap between overall and potential performance is even wider for players with club contracts,\nalbeit with longer right tails. This could also be due to a larger sample size.&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
    legend.title = element_text(face = &quot;bold&quot;, size = 15)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/geom%20ridge2-1.png" width="1152" /></p>
<p>Another way to compare performance between contracted and non-contracted players would be to use skill sets such as <code>pace</code>, <code>dribbling</code> and <code>shooting</code> that are applicable across all <code>position</code> (excluding Goalkeepers because they have their own unique skill sets such as diving).</p>
<pre class="r"><code>labels &lt;-
  c(&quot;D&quot; = &quot;Defender&quot;,
    &quot;DM&quot; = &quot;Defensive Midfielder&quot;,
    &quot;M&quot; = &quot;Midfielder&quot;,
    &quot;AM&quot; = &quot;Attacking Midfielder&quot;,
    &quot;F&quot; = &quot;Forward&quot;,
    &quot;ST&quot; = &quot;Striker&quot;)

data %&gt;%
  mutate(contracted = case_when(is.na(team_position) ~ &quot;No&quot;,
                                TRUE ~ &quot;Yes&quot;)) %&gt;%
  pivot_longer(pace:physic, names_to = &quot;skills&quot;, values_to = &quot;values&quot;) %&gt;%
  filter(!position == &quot;GK&quot;) %&gt;%
  mutate(skills = reorder_within(skills, values, position)) %&gt;%
  ggplot(aes(values, skills, fill = contracted)) +
  geom_boxplot() +
  geom_text(
    data = . %&gt;%
      group_by(position, skills) %&gt;%
      mutate(percentile = values &gt; quantile(values, 0.99999, na.rm = TRUE)) %&gt;%
      filter(percentile == 1),
    aes(label = paste(short_name, &quot;\n&quot;, str_wrap(club, width = 15), sep = &quot;&quot;), colour = position),
    size = 3,
    check_overlap = TRUE,
    fontface = &quot;bold&quot;,
    vjust = &quot;inward&quot;, hjust = &quot;inward&quot;,
    show.legend = F
  ) +
  facet_wrap( ~ position, scales = &quot;free_y&quot;, labeller = as_labeller(labels)) +
  scale_y_reordered() +
  scale_colour_fish_d(option = &quot;Antennarius_commerson&quot;) +
  scale_fill_fish_d(option = &quot;Hypsypops_rubicundus&quot;) +
  labs(
    x = &quot;Values&quot;,
    y = &quot;Skills&quot;,
    fill = &quot;Under Contract?&quot;,
    title = &quot;Players With And Without Contracts In FIFA 20 - How Do They Compare?&quot;,
    subtitle = &quot;Using traits like dribbling, passing and shooting, players with only international appearances and\nno club contracts don&#39;t appear to be less skilled.\nHowever there are significantly more outliers among players with contracts.\nThe extreme outliers and their clubs are highlighted.&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
    legend.title = element_text(face = &quot;bold&quot;, size = 15),
    legend.position = &quot;top&quot;
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/geomboxplot%20Players%20With%20And%20Without%20Contracts-1.png" width="1152" /></p>
<p>Using boxplots to identify medians, variance and outliers, I conclude that there are other reasons other than overall score and generic skills driving the non-contractual state of these players.</p>
<p>Take for example Defenders - we want a higher defending score and the median for non-contract players is higher than players with contracts. Similarly, the median for passing scores is higher for non-contract players, and the same can be said for shooting scores for Forwards and Strikers.</p>
<p>One other thing you might have observed is that there are significantly more outliers for contracted players. The <em>crème de la crème</em>, so to speak.</p>
</div>
<div id="what-makes-a-player-stand-out-from-the-crowd" class="section level2">
<h2>What Makes A Player Stand Out From The Crowd?</h2>
<p>Two columns, <code>player_tags</code> and <code>player_traits</code>, contain text descriptions of certain players’ characteristics e.g. Playmaker, Acrobat, etc, and popular traits e.g. Crowd Favourite, Beat Offside Trap, Argues with Officials, etc.</p>
<pre class="r"><code>data %&gt;%
  select(short_name, club, position, player_tags, player_traits) %&gt;% 
  na.omit() %&gt;% 
  sample_n(10)</code></pre>
<pre><code>## # A tibble: 10 x 5
##    short_name   club            position player_tags      player_traits         
##    &lt;chr&gt;        &lt;chr&gt;           &lt;fct&gt;    &lt;chr&gt;            &lt;chr&gt;                 
##  1 D. Djigla    Chamois Niorta~ M        #Speedster       Early Crosser         
##  2 T. Buhagiar  Sydney FC       AM       #Speedster, #Ac~ Early Crosser         
##  3 A. Ibargüen  Club América    M        #Speedster, #Ac~ Diver, Selfish, Crowd~
##  4 B. Boutobba  Montpellier HSC M        #Acrobat         Injury Free, Selfish,~
##  5 K. Tierney   Arsenal         D        #Engine          Early Crosser         
##  6 N. Maksimov~ Napoli          D        #Strength        Injury Prone, Long Pa~
##  7 S. Mendoza   Amiens SC       M        #Speedster       Argues with Officials~
##  8 N. Dovedan   1. FC Nürnberg  M        #Acrobat         Diver, Finesse Shot, ~
##  9 B. McKay     Swansea City    M        #Acrobat         Selfish, Early Crosse~
## 10 S. Kutschke  FC Ingolstadt ~ ST       #Aerial Threat,~ Diver, Long Passer (C~</code></pre>
<p>We can visualize the relationship between tags and traits using a network graph. First we have to wrangle our data into a long format using <code>separate</code> and <code>pivot_longer</code>, remove the tag “CPU AI Only”, and use <code>pairwise_cor</code> to find pairwise correlation across the words as that will form the basis of our network graph.</p>
<pre class="r"><code>library(widyr)
library(igraph)
library(ggraph)

corr &lt;- data %&gt;%
  select(short_name, club, position, player_tags, player_traits) %&gt;%
  separate(player_tags, paste(&quot;tag&quot;, 1:10, sep = &quot;&quot;), sep = &quot;, &quot;) %&gt;%
  separate(player_traits, paste(&quot;trait&quot;, 1:8, sep = &quot;&quot;), sep = &quot;, &quot;) %&gt;% 
  pivot_longer(tag1:trait8, names_to = &quot;tag&quot;, values_to = &quot;description&quot;, values_drop_na = T) %&gt;%
  mutate(description = str_replace(description, &quot;#&quot;, &quot;&quot;)) %&gt;% 
  filter(!str_detect(description, &quot;CPU AI Only&quot;)) %&gt;% 
  group_by(description) %&gt;% 
  filter(n() &gt; 100) %&gt;% 
  pairwise_cor(description, short_name, sort = TRUE)

corr</code></pre>
<pre><code>## # A tibble: 552 x 3
##    item1                    item2                    correlation
##    &lt;chr&gt;                    &lt;chr&gt;                          &lt;dbl&gt;
##  1 Crowd Favourite          Selfish                        0.388
##  2 Selfish                  Crowd Favourite                0.388
##  3 Speedster                Early Crosser                  0.288
##  4 Early Crosser            Speedster                      0.288
##  5 Speedster                Acrobat                        0.262
##  6 Acrobat                  Speedster                      0.262
##  7 Aerial Threat            Strength                       0.252
##  8 Strength                 Aerial Threat                  0.252
##  9 Avoids Using Weaker Foot Giant Throw-in                 0.223
## 10 Giant Throw-in           Avoids Using Weaker Foot       0.223
## # ... with 542 more rows</code></pre>
<p>Tidy Text Mining with R has a <a href="https://www.tidytextmining.com/ngrams.html#counting-and-correlating-among-sections">great tutorial</a> on how to construct network graphs.</p>
<blockquote>
<p>The igraph package has many powerful functions for manipulating and analyzing networks. One way to create an igraph object from tidy data is the <code>graph_from_data_frame()</code> function, which takes a data frame of edges with columns for “from”, “to”, and edge attributes.</p>
</blockquote>
<pre class="r"><code>set.seed(2020)

corr %&gt;%
  filter(correlation &gt; .03) %&gt;%
  graph_from_data_frame() %&gt;%
  ggraph(layout = &quot;fr&quot;) +
  geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
  geom_node_point(color = &quot;lightblue&quot;, size = 5) +
  geom_node_text(
    aes(label = name),
    repel = TRUE,
    fontface = &quot;bold&quot;,
    vjust = -1,
    hjust = -0.2
  ) +
  labs(
    title = &quot;Visualizing Correlation Of Players&#39; Tags and Traits With A Network Graph&quot;,
    subtitle = &quot;Crowd favourites tend to be selfish acrobats that excel at beating offside traps and arguing with officials\nDoes any particular player come to mind?&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
    theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/network%20graph-1.png" width="1152" /></p>
</div>
<div id="do-soccer-players-age-like-wine" class="section level2">
<h2>Do Soccer Players Age Like Wine?</h2>
<p>To investigate a player’s score as the years fly by, we bucket age into two categories - before and after twenty five (mean age is 25.3 years), and use <code>ggscatmat()</code> against variables such as <code>value_eur</code>, <code>wage_eur</code>, <code>overall</code> and <code>potential</code>. This gives a scatterplot matrix with density plots on the diagonal and correlation printed in the upper triangle.</p>
<pre class="r"><code>library(GGally)

data %&gt;%
  mutate(
    age_segment = case_when(
      age &lt; 23 ~ &quot;Age&lt;23&quot;,
      between(age, 23, 25) ~ &quot;Age 23-25&quot;,
      between(age, 26, 29) ~ &quot;Age 26-29&quot;,
      TRUE ~ &quot;Age&gt;29&quot;
    )
  ) %&gt;%
  select(age, value_eur, wage_eur, overall, potential, age_segment) %&gt;%
  ggscatmat(columns = 1:5, color = &quot;age_segment&quot;) +
  scale_color_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(title = &quot;Players Aged &lt;23 +ve Correlated With Higher Value/Wages/Overall Score&quot;,
       subtitle = &quot;Beyond 29 years of age, we start to see negative correlation&quot;,
       color = &quot;Age Segment&quot;,
       caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    legend.title = element_text(face = &quot;bold&quot;)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/ggscatmat-1.png" width="1152" /></p>
<p>There is some positive correlation observed between players aged 23 and younger and their associated <code>value_eur</code>, <code>wage_eur</code> and <code>overall</code> score. Conversely, beyond 29 years of age, we observe some negative correlation too between <code>age</code> and <code>value_eur</code>, <code>wage_eur</code> and <code>overall</code> score.</p>
<p>This isn’t too surprising as the average retirement age of a football player is said to be <a href="https://www.thepfa.com/equalities/commitment-to-all/age#:~:text=Age,player%20is%2035%20years%20old">35 years old</a>, according to the Professional Footballers’ Association.</p>
</div>
<div id="bargain-hunting-at-clubs" class="section level2">
<h2>Bargain Hunting At Clubs</h2>
<p>Information about the biggest and richest clubs are easily available online and buying a star player from any of those clubs would easily cost a fortune. <strong>What I reckon could be more interesting is identifying clubs by a metric I call <code>pot_per_dollar</code>: A player’s <code>potential</code> score divided by his current <code>value_eur</code></strong>. Summing all of the players, we get the club’s <code>pot_per_dollar</code>.</p>
<p>Clubs with the highest <code>pot_per_dollar</code> are great for bargain hunting because there is a good chance to find high potential players with a cheap asking price that you could snap up. We can further segment our data by continent to address geographical-related transfer constraints, if any.</p>
<pre class="r"><code>#adding continents
geography &lt;- data %&gt;%
  mutate(continent = countrycode(nationality,
                                 origin = &quot;country.name&quot;,
                                 destination = &quot;continent&quot;)) %&gt;%
  #place Brexit countries back into Europe
  mutate(continent = replace_na(continent, &quot;Europe&quot;))

geography %&gt;% 
  select(short_name, club, nationality, continent) %&gt;% 
  sample_n(10)</code></pre>
<pre><code>## # A tibble: 10 x 4
##    short_name    club                 nationality continent
##    &lt;chr&gt;         &lt;chr&gt;                &lt;chr&gt;       &lt;chr&gt;    
##  1 D. Parrett    Stevenage            England     Europe   
##  2 L. McGee      Portsmouth           England     Europe   
##  3 Ignasi Miquel Girona FC            Spain       Europe   
##  4 J. Rollinson  Stevenage            England     Europe   
##  5 R. Uehara     Júbilo Iwata         Japan       Asia     
##  6 D. Cvitanich  Racing Club          Argentina   Americas 
##  7 Zheng Dalun   Tianjin Quanjian FC  China PR    Asia     
##  8 O. Oularé     Standard de Liège    Belgium     Europe   
##  9 W. Marinus    FC Emmen             Netherlands Europe   
## 10 I. Sissoko    RC Strasbourg Alsace France      Europe</code></pre>
<pre class="r"><code>#identify the clubs with the highest potential per wage dollar paid
list &lt;- geography %&gt;%
  #remove players with no clubs and no wages paid, and some players with 0 value
  filter(!is.na(team_position),
         value_eur &gt; 0) %&gt;%
  select(short_name, club, potential, value_eur, nationality, continent) %&gt;% 
  #each player&#39;s potential per dollar of wages paid. Higher is better.
  mutate(pot_per_dollar = potential / value_eur) %&gt;%
  group_by(club) %&gt;% 
  summarise(total_pot = sum(pot_per_dollar)) %&gt;% 
  arrange(desc(total_pot)) %&gt;% 
  head(20)

geography %&gt;%
  #filter data set for clubs in list
  filter(club %in% list$club,
         value_eur &gt; 0) %&gt;%
  select(short_name, club, potential, value_eur, nationality, continent) %&gt;%
  mutate(
    pot_per_dollar = potential / value_eur,
    club = fct_reorder(club, pot_per_dollar, .fun = sum)
  ) %&gt;%
  ggplot(aes(club, pot_per_dollar)) +
  geom_col(aes(fill = continent)) +
  coord_flip() +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(
    x = &quot;Club&quot;,
    y = &quot;Club&#39;s Total Potential Per Value&quot;,
    fill = &quot;Continent&quot;,
    title = &quot;Bargain Hunting: Clubs With High Potential Players At Lowest Prices&quot;,
    subtitle = &quot;Sorted by this metric, we can see promising clubs can be found in Asia and Europe leagues.&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
    legend.title = element_text(face = &quot;bold&quot;)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/pot_dollar-1.png" width="1152" /></p>
</div>
<div id="principal-components-analysis" class="section level2">
<h2>Principal Components Analysis</h2>
<p><code>tidymodels</code> allows for seamless and fuss-free Principal Components Analysis (PCA) implementation, and this wide data set is great with nearly 40 variables.</p>
<p>As the webpage reference for <a href="https://recipes.tidymodels.org/reference/step_pca.html">recipes::step_pca()</a> describes it:</p>
<blockquote>
<p>Principal component analysis (PCA) is a transformation of a group of variables that produces a new set of artificial features or components. These components are designed to capture the maximum amount of information (i.e. variance) in the original variables. Also, the components are statistically independent from one another. This means that they can be used to combat large inter-variables correlations in a data set.</p>
</blockquote>
<p>We first load the <code>tidymodels</code> meta package, then filter players with no teams and all goalkeepers (they have a separate skill set), followed by selecting of columns. Let’s also segment <code>age</code> per its quantiles and use it as variables for PCA.</p>
<pre class="r"><code>library(skimr)

geography$age %&gt;% 
  skim()</code></pre>
<table>
<caption>(#tab:age quantiles)Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">18278</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">data</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">25.28</td>
<td align="right">4.66</td>
<td align="right">16</td>
<td align="right">22</td>
<td align="right">25</td>
<td align="right">29</td>
<td align="right">42</td>
<td align="left">▆▇▆▂▁</td>
</tr>
</tbody>
</table>
<pre class="r"><code>library(tidymodels)

pca_rec &lt;- geography %&gt;%
  filter(!is.na(team_jersey_number), !position == &quot;GK&quot;) %&gt;%
  mutate(age_segment = case_when(
      age &lt; 23 ~ &quot;Age&lt;23&quot;,
      between(age, 23, 25) ~ &quot;Age 23-25&quot;,
      between(age, 26, 29) ~ &quot;Age 26-29&quot;,
      TRUE ~ &quot;Age&gt;29&quot;)) %&gt;%
  select(
    #identifiers
    sofifa_id, short_name, long_name, club, value_eur,
    #categorical
    preferred_foot, position, continent, age_segment,
    #numeric
    overall:potential, team_jersey_number, skill_moves,
    pace:physic, attacking_crossing:defending_sliding_tackle
  ) %&gt;%
  recipe( ~ .) %&gt;%
  update_role(sofifa_id, short_name, long_name, club, value_eur, new_role = &quot;id&quot;) %&gt;%
  step_dummy(preferred_foot, position, continent, age_segment) %&gt;%
  step_normalize(all_predictors()) %&gt;%
  step_pca(all_predictors())</code></pre>
<p>Note that we did not define an outcome/response in our <code>recipe()</code> function, so this is unsupervised learning. Our recipe contains:</p>
<ul>
<li><code>update_role()</code> is used to indicate variables that should not be included when executing pre-processing with <code>prep()</code> later on, and that these variables are only included as identifiers.</li>
<li>Because PCA only takes in numeric data, we convert our categorical data to numbers with <code>step_dummy()</code>, which converts nominal data (e.g. character or factors) into one or more numeric binary model terms for the levels of the original data.</li>
<li>PCA is sensitive to outliers so <code>step_normalize()</code> essentially scales and centers all numeric variables to have a standard deviation of one and a mean of zero.</li>
<li>Finally, <code>step_pca()</code> implements Principal Component Analysis.</li>
</ul>
<p>The recipe only begins executing the pre-processing steps after we run <code>prep()</code>.</p>
<pre class="r"><code>pca_prep &lt;- pca_rec %&gt;% 
  prep()

pca_prep</code></pre>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##         id          5
##  predictor         43
## 
## Training data contained 16042 data points and no missing data.
## 
## Operations:
## 
## Dummy variables from preferred_foot, position, continent, age_segment [trained]
## Centering and scaling for overall, potential, ... [trained]
## PCA extraction with overall, potential, ... [trained]</code></pre>
<p>We can use <code>tidy()</code> to extract our PCA results in a convenient tidy format which we can then subsequently visualize.</p>
<pre class="r"><code>#tidy(df,3) lets us extract the third recipe step i.e. step_pca
tidied_pca &lt;- tidy(pca_prep, 3)

tidied_pca %&gt;%
  filter(component %in% paste0(&quot;PC&quot;, 1:4)) %&gt;%
  mutate(component = fct_inorder(component)) %&gt;%
  ggplot(aes(value, terms, fill = terms)) +
  geom_col(show.legend = FALSE) +
  facet_wrap( ~ component, nrow = 1) +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(
    x = &quot;Value&quot;,
    y = &quot;Traits&quot;,
    fill = &quot;&quot;,
    title = &quot;PCA: A High-Level Overview Of The First Four Features Created&quot;,
    subtitle = NULL,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/visual%20high-level-1.png" width="1152" /></p>
<p>Let’s dive deeper into the top 15 traits that defines each of these four features.</p>
<pre class="r"><code>tidied_pca %&gt;%
  filter(component %in% paste0(&quot;PC&quot;, 1:4)) %&gt;%
  group_by(component) %&gt;%
  top_n(20, abs(value)) %&gt;%
  ungroup() %&gt;%
  mutate(terms = reorder_within(terms, abs(value), component)) %&gt;%
  ggplot(aes(abs(value), terms, fill = value &gt; 0)) +
  geom_col() +
  facet_wrap(~component, scales = &quot;free_y&quot;) +
  scale_y_reordered() +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(
    x = &quot;Absolute Value of Contribution&quot;,
    y = NULL, 
    fill = &quot;Positive?&quot;,
    title = &quot;PCA: Visualizing The First Four Features (PC1-PC4) Created&quot;,
    subtitle = &quot;Interpretation: As PC1 gets more negative, it captures offensive midfielder/playmaker traits;\nPC3: Hallmarks of a classic striker (strength, finishing, shooting) vs Movement/Agility traits&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
    legend.title = element_text(face = &quot;bold&quot;)
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/visual%20deep-dive-1.png" width="1152" /></p>
<p>Below is my interpretation for PC1-PC4:</p>
<ul>
<li>PC1: Negative indicates offensive midfielder / <a href="https://en.wikipedia.org/wiki/Playmaker">playmaker</a> traits</li>
<li>PC2: Negative indicates defender / defensive midfielder traits</li>
<li>PC3: Striker traits (+ve) versus defenders with high movement-related traits (-ve)</li>
<li>PC4: Passing-related traits (+ve) versus finesse-related traits (-ve)</li>
</ul>
<p>Now let’s assess how accurate our PCA features are by visualizing the most valuable players against our features.</p>
<pre class="r"><code>#Getting our top 50 valuable players ex GKs
valuable &lt;- geography %&gt;%
  filter(!is.na(team_jersey_number),
         !position == &quot;GK&quot;) %&gt;%
  arrange(desc(value_eur)) %&gt;% 
  select(long_name) %&gt;% 
  slice(1:100)

juice(pca_prep) %&gt;%
  filter(long_name %in% valuable$long_name) %&gt;%
  left_join(geography %&gt;% select(sofifa_id, position)) %&gt;% 
  ggplot(aes(PC1, PC3, label = paste(
    short_name, &quot; &quot;, &quot;(&quot;, str_wrap(club, width = 20), &quot;)&quot;, &quot;\n&quot;, &quot;EUR&quot;, value_eur/1000000, &quot;m&quot;, sep = &quot;&quot;))) +
  geom_point(aes(color = position), alpha = 0.75, size = 5) +
  geom_text(
    check_overlap = TRUE,
    vjust = &quot;inward&quot;,
    hjust = &quot;inward&quot;,
    size = 4,
    fontface = &quot;bold&quot;) +
  scale_colour_fish_d(option = &quot;Hypsypops_rubicundus&quot;) +
  scale_x_continuous() +
  labs(
    x = &quot;PC1&quot;,
    y = &quot;PC3&quot;,
    color = &quot;Position&quot;,
    title = &quot;FIFA 20: Top 100 Most Valuable Soccer Players (ex GKs) Mapped Against PC1 and PC3&quot;,
    subtitle = &quot;Offensive midfielders/playmakers are towards the left, defenders are mapped towards the right,\nStrikers can be found towards the top, while defensive roles with high movement scores are towards the bottom.&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    legend.title = element_text(face = &quot;bold&quot;),
    legend.position = &quot;top&quot;
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/top50%20most%20valuable-1.png" width="1728" /></p>
<p>To my knowledge it looks like the positions are mapped out fairly accurately. Well-known players such as Messi, Ronaldo and Neymar have dazzled the world with their dribbling and shooting - and have been aptly mapped towards the left most of this chart.</p>
<p>Revisiting our bargain hunting theme, let’s run PCA on the top 100 players with the highest <code>pot_per_dollar</code>.</p>
<pre class="r"><code>pot_dollar &lt;- geography %&gt;% 
  filter(!is.na(team_jersey_number),
         !position == &quot;GK&quot;,
         value_eur &gt; 0) %&gt;% 
  mutate(pot_per_dollar = potential / value_eur) %&gt;% 
  arrange(desc(pot_per_dollar)) %&gt;% 
  select(long_name, pot_per_dollar) %&gt;% 
  slice(1:100)

juice(pca_prep) %&gt;%
  filter(long_name %in% pot_dollar$long_name) %&gt;%
  left_join(geography %&gt;% select(sofifa_id, position)) %&gt;% 
  ggplot(aes(PC1, PC3, label = paste(
    short_name, &quot; &quot;, &quot;(&quot;, str_wrap(club, width = 20), &quot;)&quot;, &quot;\n&quot;, &quot;EUR&quot;, value_eur/1000, &quot;k&quot;, sep = &quot;&quot;))) +
  geom_point(aes(color = position), alpha = 0.75, size = 5) +
  geom_text(
    check_overlap = TRUE,
    hjust = &quot;left&quot;,
    size = 4,
    fontface = &quot;bold&quot;
  ) +
  scale_colour_fish_d(option = &quot;Hypsypops_rubicundus&quot;) +
  labs(
    x = &quot;PC1&quot;,
    y = &quot;PC3&quot;,
    color = &quot;Position&quot;,
    title = &quot;FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar&quot;,
    subtitle = &quot;Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    legend.title = element_text(face = &quot;bold&quot;),
    legend.position = &quot;top&quot;
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/top50%20pot_dollar-1.png" width="1728" /></p>
<p>First and foremost, what’s interesting about this chart is the x-axis. Our previous Top 50 Most Valuable Players chart had a strong bias towards negative PC1 values (players with offensive traits), while our current chart has a strong bias towards positive PC1 values(players with defensive traits) and we consequently see significantly more defenders showing up.</p>
<p>Finally, recall PC2 was the feature created that was tilted towards defender / defensive midfielder traits. Let’s pick four of the defenders located furthest to the right and map PC2 components against their strongest traits.</p>
<pre class="r"><code>library(gghighlight)

PC2 &lt;- tidied_pca %&gt;%
  filter(component == &quot;PC2&quot;) %&gt;%
  top_n(15, abs(value))

geography %&gt;%
  filter(str_detect(short_name, &quot;T. French|Y. Fujita|A. Bennett|J. McCombe&quot;)) %&gt;%
  select(
    short_name, club, player_positions, position,
    overall:potential, pace:physic,attacking_crossing:defending_sliding_tackle
  ) %&gt;%
  pivot_longer(
    c(overall:potential, pace:physic, attacking_crossing:defending_sliding_tackle),
    names_to = &quot;traits&quot;,
    values_to = &quot;scores&quot;
  ) %&gt;%
  group_by(short_name) %&gt;% 
  top_n(20, scores) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(reorder_within(traits, scores, short_name), scores)) +
  geom_col(aes(fill = short_name), show.legend = F) +
  gghighlight(traits %in% PC2$terms, calculate_per_facet = T) +
  coord_flip() +
  facet_wrap(~ short_name, scales = &quot;free_y&quot;) +
  scale_x_reordered() +
  scale_fill_fish_d(option = &quot;Antennarius_commerson&quot;) +
  labs(
    x = &quot;Traits&quot;,
    y = &quot;Scores&quot;,
    title = &quot;How Does PC2 Components Map Onto These Four Defenders&#39; Top Traits?&quot;,
    subtitle = &quot;Not surprisingly, the top PC2 components are featured strongly across all four players&#39; traits&quot;,
    caption = &quot;Source: FIFA 20 Complete Player Data Set&quot;
  ) +
  theme(
    plot.title = element_text(face = &quot;bold&quot;, size = 20),
    plot.subtitle = element_text(size = 17),
    strip.background = element_blank(),
    strip.text = element_text(face = &quot;bold&quot;, size = 15),
  ) </code></pre>
<p><img src="/post/2020-06-18-scoring-visualization-goals-with-pca-and-fifa-20.en-us_files/figure-html/gghighlight-1.png" width="1152" /></p>
<p>I think there are plenty of questions that warrant further investigation here, and personally this blog post really made me appreciate PCA and the intuition it brings. It’s been one of my long-time visualization goals to use network graphs and ridgeline plots, and its great to be able to add them to my EDA toolkit. A big shout-out to Wen Hao for spotting some errors in my initial charts!</p>
</div>
</div>
